---
title: "Main Linear Model Analysis"
author: "Sho"
date: "11/26/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```


# Loading in Data 

Loading as done by Seokjun. 

```{r}
data <- read.csv("MH_survey_only_higher_index.csv",
    na.strings = "NA")
names(data)
#only relevant for Seokjun's PC 
names(data)[1] <- "gender"

data <- data[, -c(17:22)]


# Assigning factors 
data$gender <- factor(data$gender)
data$age_group <- factor(data$age_group)
data$country_lockdown <- factor(data$country_lockdown)
data$marital <- factor(data$marital)
data$smoking <- factor(data$smoking)
data$fivfruitveg <- factor(data$fivfruitveg)
data$shielded <- factor(data$shielded)
data$week_soc_distancing <- factor(data$week_soc_distancing)
data$athlete <- factor(data$athlete)
```



# Step-wise Regression 

Here we conduct the step-wise regression using step. 
Note for Seokjun: `step` actually terminates at a different point if you take out missing data. 
This is an issue. 

The final model is pretty different than what we had before. 

```{r}
model_full <- lm(MHC_SF_OVERALL ~ ., data = data[complete.cases(data), ])
summary(model_full)

step(model_full, direction = "backward")
```





```{r}
model_step9 = lm(formula = MHC_SF_OVERALL ~ gender + age_group + week_soc_distancing + 
    athlete + HADS_OVERALL + RES_TOTAL + LONE_TOTAL, data = data[complete.cases(data), 
    ])  
model_step9  %>% summary()
```

```{r fig.width=8, fig.height=5}
par(mfrow = c(2, 2))
plot(model_step9)
```

Residual plots look almost perfect!  364 is an outlier but has very low leverage which is great.  

# Outlier Analysis

```{r}
model_step9$model %>% summary()
```

The outlier point is unusual in terms of weeks social distancing and the maximum LONE score (very lonely).  

```{r}
model_step9$model[364, ]

```


# Testing All Interactions

Here we run the F-Test on all secondary interactions.  It returned a small F statistic and high p-value. 

```{r}
model_interaction = lm(formula = MHC_SF_OVERALL ~ (gender + age_group + week_soc_distancing + 
    athlete + HADS_OVERALL + RES_TOTAL + LONE_TOTAL)^2, data = data[complete.cases(data), ])  
anova(model_step9, model_interaction)
```


comment (nov 27 1:30 am): 

First of all, thanks Sho!

I think next thing to do is

1. delete HAD or RES (because of Collinearity) <- we can do this right after 'step' function result
2. draw diagnosis plot (residual, normal qq, leverage, ... using 'plot(lm_fit_object)', 
    delete outlier/other annoying points.
    please make a figure to show an outlier if it exists.
    And, if there are variance problem (heteroskedasticity or ...), stop and rest (let's discuss together)
3. re-fit lm (after deleting things in 1 and 2)
4. basic test: F test for model significance(first!) -> 
    t test for continuous variable, model comparison F-test (for each categorical variable group)
5. visualize fitting result (if we can. if it is too high dimention, just make a table). See R^2/AIC/BIC,...
6. residual analysis (same as 2)
7. if we want:
    make prediction example?
    or... ???

(I think) By Tuesday, we don't have to finish writing everything, but
just 4,5,6(+7) steps table and figure is enough.

Let's write together. Don't write it all alone! I'll help you

And, please give me an idea to visualize the Lasso fit. 
After making 2 plots, I don't know what to do.
